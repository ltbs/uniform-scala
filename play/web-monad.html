<html><head><title>uniform-scala: WebMonad</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Luke Tebbs" /><meta name="description" content="Purely functional user-interaction" /><meta name="og:image" content="/uniform-scala/img/poster.png" /><meta name="image" property="og:image" content="/uniform-scala/img/poster.png" /><meta name="og:title" content="uniform-scala: WebMonad" /><meta name="title" property="og:title" content="uniform-scala: WebMonad" /><meta name="og:site_name" content="uniform-scala" /><meta name="og:url" content="https://ltbs.github.io/uniform-scala/" /><meta name="og:type" content="website" /><meta name="og:description" content="Purely functional user-interaction" /><link rel="icon" type="image/png" href="/uniform-scala/img/favicon.png" /><meta name="twitter:title" content="uniform-scala: WebMonad" /><meta name="twitter:image" content="/uniform-scala/img/poster.png" /><meta name="twitter:description" content="Purely functional user-interaction" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/uniform-scala/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/uniform-scala/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/uniform-scala/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/uniform-scala/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/uniform-scala/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/uniform-scala/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/uniform-scala/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/uniform-scala/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/uniform-scala/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/uniform-scala/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/uniform-scala/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/uniform-scala/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/uniform-scala/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/uniform-scala/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/uniform-scala/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/uniform-scala/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/uniform-scala/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/uniform-scala/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/uniform-scala/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/uniform-scala/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/uniform-scala/highlight/styles/color-brewer.css" /><link rel="stylesheet" href="/uniform-scala/css/style.css" /><link rel="stylesheet" href="/uniform-scala/css/palette.css" /><link rel="stylesheet" href="/uniform-scala/css/codemirror.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/uniform-scala/" class="brand"><div class="brand-wrapper"><span>uniform-scala</span></div></a></li> <li><a href="/uniform-scala/index.html" class="">Home</a></li> <li><a href="/uniform-scala/setup.html" class="">Setup</a></li> <li><a href="/uniform-scala/core/basic-program.html" class="">Writing a journey</a> <ul class="sub_section"> <li><a href="/uniform-scala/core/tells.html" class="">Telling</a></li> <li><a href="/uniform-scala/core/asks.html" class="">Asking</a></li> <li><a href="/uniform-scala/core/interacts.html" class="">Interacting</a></li> <li><a href="/uniform-scala/core/validation.html" class="">Validation</a></li> <li><a href="/uniform-scala/core/branching.html" class="">Branching</a></li> <li><a href="/uniform-scala/core/remote-calls.html" class="">Remote Calls</a></li></ul></li> <li><a href="/uniform-scala/play/index.html" class="">Play Framework Interpreter</a> <ul class="sub_section"> <li><a href="/uniform-scala/play/controllers.html" class="">Controllers</a></li> <li><a href="/uniform-scala/play/web-monad.html" class=" active ">WebMonad</a></li> <li><a href="/uniform-scala/play/internationalisation.html" class="">Internationalisation</a></li> <li><a href="/uniform-scala/play/listing-pages.html" class="">Listing Pages</a></li> <li><a href="/uniform-scala/play/remote-calls.html" class="">Memoisation</a></li></ul></li> <li><a href="/uniform-scala/interpreters.html" class="">Other Interpreters</a> <ul class="sub_section"> <li><a href="/uniform-scala/interpreter-cli.html" class="">CLI Interpreter</a></li> <li><a href="/uniform-scala/interpreter-logic-table.html" class="">Logic Table Interpreter</a></li> <li><a href="/uniform-scala/interpreter-static-site.html" class="">Static Site interpreter</a></li> <li><a href="/uniform-scala/interpreter-selenium.html" class="">Selenium Interpreter</a></li></ul></li> <li><a href="/uniform-scala/core/advanced.html" class="">Advanced Options</a> <ul class="sub_section"> <li><a href="/uniform-scala/core/writing-interpreters.html" class="">Writing Interpreters</a></li></ul></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/ltbs/uniform-scala"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/ltbs/uniform-scala"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('uniform-scala Purely functional user-interaction');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('uniform-scala Purely functional user-interaction');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="ltbs" data-github-repo="uniform-scala"><div class="content-wrapper"><section><h1 id="how-it-works---the-web-monad">How it works - the Web Monad</h1>

<p>The uniform play interpreter is based off the observation that
interaction with a play-based web journey can be thought of as an
<code class="highlighter-rouge">Either[Result, A]</code> for a given <code class="highlighter-rouge">ask[A]</code> as long as <code class="highlighter-rouge">Either</code> is
right-associative monad.</p>

<p>Given an <code class="highlighter-rouge">ask[Address]</code> we would convert that to <code class="highlighter-rouge">Either[Result, Address]</code></p>

<p>A <code class="highlighter-rouge">Right[Result, Address]</code> would represent that the user has supplied
a value which has passed validation, in this situation we can proceed
to the next step in the journey.</p>

<p>A <code class="highlighter-rouge">Left[Result, Address]</code> could represent a number of things, but for
simplicity we’ll consider the main ones as -</p>

<ol>
  <li>No data submitted (render an empty form)</li>
  <li>Data submitted, validation not passed (render a populated form with
an error message)</li>
  <li>Data submitted previously, form being revisited by the user (render a
populated form)</li>
</ol>

<p>When running a single <code class="highlighter-rouge">ask[A]</code> we get either a new page to be rendered (a
<code class="highlighter-rouge">Left(someResult)</code>) or we get a <code class="highlighter-rouge">Right[A]</code>. Because right-associative
<code class="highlighter-rouge">Either</code> is a <code class="highlighter-rouge">cats.Monad</code> that captures the error context we can compose
all our steps into one big <code class="highlighter-rouge">Either[Result, B]</code>.</p>

<p>Inside our controller we invoke our program with the play
interpreter. Along with the program we supply a <em>terminating fold</em> of the
form <code class="highlighter-rouge">B =&gt; Future[Result]</code> which allows us to specify what should happen when
we get to the end of the journey along with what should be sent to the
user.</p>

<p>And this is the basis of how web journeys work in Uniform. In practice
we cannot encapsulate everything in an <code class="highlighter-rouge">Either[Result, ?]</code>, so the
actual <code class="highlighter-rouge">Webmonad</code> is closer to the following -</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>type WebInner[A] = RWST[Future, (JourneyConfig, List[String], Request[AnyContent]), Unit, (Path, DB), A]
type WebMonad[A] = EitherT[WebInner, Result, A]
</code></pre></div></div>

<p>Our steps must be within <code class="highlighter-rouge">Future</code> in order to support scenarios where
we need to call some remote process (for example to do an address
lookup).</p>

<p>The <code class="highlighter-rouge">JourneyConfig</code> reader is merely a placeholder for configuration options that
may be needed in the future.</p>

<p>The <code class="highlighter-rouge">List[String]</code> reader is used for the URL pieces, for example -</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://server.com/path-to-journey/one/two/three/ =&gt; List("one","two","three")
</code></pre></div></div>

<p>Normally the user will move through the journey naturally (there is a
redirect following a validated post), however this allows the user to
explicitly give a step (for example if they want to go back in the
journey and change an answer)<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>.</p>

<p>The <code class="highlighter-rouge">Request</code> reader is used mainly for extracting the payload from a
POST request.</p>

<p>The <code class="highlighter-rouge">Path</code> state allows all pages to know the pages that have come
before them, and can be used to create breadcrumb hyperlinks on the
page.</p>

<p><code class="highlighter-rouge">DB</code> is an alias for <code class="highlighter-rouge">Map[List[String],String]</code> and its usage in the
state is for serialising the data the user has been input. This is
handled by the <code class="highlighter-rouge">PersistenceEngine</code>.</p>
<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>Although the user can <em>request</em> any page they like uniform will
not allow the user to bypass validation or skip pages without
answering questions. <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/uniform-scala/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlighting();
              </script><script src="/uniform-scala/js/main.js"></script></body></html>