<!DOCTYPE html><html><head><title>uniform-scala: Validation</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Luke Tebbs" /><meta name="description" content="Purely functional user-interaction" /><meta name="og:image" content="/uniform-scala/img/poster.png" /><meta name="image" property="og:image" content="/uniform-scala/img/poster.png" /><meta name="og:title" content="uniform-scala: Validation" /><meta name="title" property="og:title" content="uniform-scala: Validation" /><meta name="og:site_name" content="uniform-scala" /><meta name="og:url" content="https://ltbs.github.io/uniform-scala/" /><meta name="og:type" content="website" /><meta name="og:description" content="Purely functional user-interaction" /><link rel="icon" type="image/png" href="/uniform-scala/img/favicon.png" /><meta name="twitter:title" content="uniform-scala: Validation" /><meta name="twitter:image" content="/uniform-scala/img/poster.png" /><meta name="twitter:description" content="Purely functional user-interaction" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/uniform-scala/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/uniform-scala/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/uniform-scala/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/uniform-scala/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/uniform-scala/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/uniform-scala/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/uniform-scala/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/uniform-scala/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/uniform-scala/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/uniform-scala/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/uniform-scala/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/uniform-scala/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/uniform-scala/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/uniform-scala/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/uniform-scala/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/uniform-scala/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/uniform-scala/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/uniform-scala/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/uniform-scala/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/uniform-scala/img/favicon310x150.png" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/uniform-scala/highlight/styles/color-brewer.css" /><link rel="stylesheet" href="/uniform-scala/css/light-style.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><div id="sidebar-brand"><a href="/uniform-scala/" class="brand"><div class="brand-wrapper"></div><span>uniform-scala</span></a><button id="main-toggle" class="sidebar-toggle"><span class="close"></span></button></div><div class="sidebar-nav"> <div class="sidebar-nav-item  "><a href="/uniform-scala/index.html" title="Home" class="">Home</a></div> <div class="sidebar-nav-item  "><a href="/uniform-scala/setup.html" title="Setup" class="">Setup</a></div> <div class="sidebar-nav-item  "><a href="/uniform-scala/core/basic-program.html" title="Writing a journey" class="drop-nested">Writing a journey</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/uniform-scala/core/tells.html" title="Telling" class="">Telling</a> <a href="/uniform-scala/core/asks.html" title="Asking" class="">Asking</a> <a href="/uniform-scala/core/composition.html" title="Composition" class="">Composition</a> <a href="/uniform-scala/core/interacts.html" title="Interacting" class="">Interacting</a> <a href="/uniform-scala/core/branching.html" title="Branching" class="">Branching</a> <a href="/uniform-scala/core/subjourney.html" title="Subjourneys" class="">Subjourneys</a> <a href="/uniform-scala/core/remote-calls.html" title="Remote Calls" class="">Remote Calls</a></div></div> <div class="sidebar-nav-item  "><a href="/uniform-scala/interpreter-play27/index.html" title="Play Framework Interpreter" class="drop-nested">Play Framework Interpreter</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/uniform-scala/interpreter-play27/controllers.html" title="Controllers" class="">Controllers</a> <a href="/uniform-scala/interpreter-play27/alternative-templating.html" title="Alternative templating technologies" class="">Alternative templating technologies</a></div></div> <div class="sidebar-nav-item  "><a href="/uniform-scala/common-web/index.html" title="Generic Web Interpreters" class="drop-nested">Generic Web Interpreters</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/uniform-scala/common-web/web-monad.html" title="WebMonad" class="">WebMonad</a> <a href="/uniform-scala/common-web/internationalisation.html" title="Internationalisation" class="">Internationalisation</a> <a href="/uniform-scala/common-web/remote-calls.html" title="Memoisation" class="">Memoisation</a> <a href="/uniform-scala/common-web/derivation-of-views.html" title="Derivation of views" class="">Derivation of views</a></div></div> <div class="sidebar-nav-item  "><a href="/uniform-scala/interpreters.html" title="Other Interpreters" class="drop-nested">Other Interpreters</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/uniform-scala/interpreter-static-site.html" title="Static Site interpreter" class="">Static Site interpreter</a></div></div> <div class="sidebar-nav-item  "><a href="/uniform-scala/core/internationalisation.html" title="Internationalisation" class="">Internationalisation</a></div> <div class="sidebar-nav-item  "><a href="/uniform-scala/core/writing-interpreters.html" title="Writing Interpreters" class="">Writing Interpreters</a></div></div></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="search-nav"><div id="search-dropdown"><label><i class="fa fa-search"></i>Search</label><input id="search-bar" type="text" placeholder="Enter keywords here..." onclick="displayToggleSearch(event)" /><ul id="search-dropdown-content" class="dropdown dropdown-content"></ul></div></li><li id="gh-eyes-item" class="hidden-xs to-uppercase"><a href="https://github.com/ltbs/uniform-scala" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs to-uppercase"><a href="https://github.com/ltbs/uniform-scala" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="ltbs" data-github-repo="uniform-scala"><div class="content-wrapper"><section><h1 id="validation">Validation</h1>

<p>For any given <code class="language-plaintext highlighter-rouge">interact[Tell, Ask]</code> the validation data structure is
<code class="language-plaintext highlighter-rouge">List[List[Rule[Ask]]]</code>.</p>

<p>Each inner groups of Rules is carried out ‘concurrently’ (error
accumulating) before sequentially passing validation on to the next
stage (fail-fast).</p>

<p>This means that error checking can be applied in-order, all together
or some mix of the two. For example, you might want to check that a
user supplies valid data on all the fields in an address. It would be
annoying for the user if they corrected an error on the first field
then resubmitted before seeing an error on the second field. In this
case you’d want the errors to accumulate. Once all the initial checks
pass you might want to then run a check afterwards, for example to
ensure the address actually exists or can be delivered to.</p>

<p>Lets start with an example with no validation at all -</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">ltbs.uniform._</span><span class="o">,</span> <span class="n">validation</span><span class="o">.</span><span class="k">_</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Address</span><span class="o">(</span>
    <span class="n">line1</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
    <span class="n">line2</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
    <span class="n">line3</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
    <span class="n">line4</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
    <span class="n">postcode</span><span class="k">:</span> <span class="kt">String</span>
<span class="o">)</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">lines</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
      <span class="nc">List</span><span class="o">(</span><span class="n">line1</span><span class="o">,</span> <span class="n">line2</span><span class="o">,</span> <span class="n">line3</span><span class="o">,</span> <span class="n">line4</span><span class="o">,</span> <span class="n">postcode</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">def</span> <span class="n">askAddress1</span> <span class="k">=</span> <span class="n">ask</span><span class="o">[</span><span class="kt">Address</span><span class="o">](</span><span class="s">"post-to"</span><span class="o">)</span>
</code></pre></div></div>

<p>We can start with a single rule, a simple regex check against a postcode -</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats.data.NonEmptyList</span>

<span class="k">val</span> <span class="n">regex</span> <span class="k">=</span> <span class="s">"^[A-Z]{1,2}\\d[A-Z\\d]? ?\\d[A-Z]{2}$"</span>
<span class="k">val</span> <span class="n">postcodeCheck</span> <span class="k">=</span> <span class="nc">Rule</span><span class="o">.</span><span class="n">cond</span><span class="o">[</span><span class="kt">Address</span><span class="o">](</span><span class="k">_</span><span class="o">.</span><span class="n">postcode</span><span class="o">.</span><span class="n">matches</span><span class="o">(</span><span class="n">regex</span><span class="o">),</span> <span class="s">"bad-postcode"</span><span class="o">)</span>
</code></pre></div></div>

<p>Here we have given a scenario for an error as a partial function. It
is important to remember we are dealing with negatives - matching
against a bad input rather than giving a predicate for a good
record.</p>

<p>The regex is used as a guard and an <code class="language-plaintext highlighter-rouge">ErrorMsg</code> is supplied
along with a non-empty path to where on the form/input data structure
the error applies. There can be several paths because in some cases
the error may be applicable to several fields - if the town doesn’t
match the postcode we might want to display the error on both those
fields.</p>

<p>We can now test our rule on the REPL or in a unit test -</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="n">testAddress</span><span class="k">:</span> <span class="kt">Address</span> <span class="o">=</span> <span class="nc">Address</span><span class="o">(</span>
  <span class="s">"12 The Street"</span><span class="o">,</span>
  <span class="s">"Genericford"</span><span class="o">,</span>
  <span class="s">"Madeupshire"</span><span class="o">,</span>
  <span class="s">""</span><span class="o">,</span>
  <span class="s">"BAD POSTCODE"</span>
<span class="o">)</span>
<span class="c1">// testAddress: Address = Address(
//   "12 The Street",
//   "Genericford",
//   "Madeupshire",
//   "",
//   "BAD POSTCODE"
// )
</span>
<span class="n">postcodeCheck</span><span class="o">.</span><span class="n">apply</span><span class="o">(</span><span class="n">testAddress</span><span class="o">)</span>
<span class="c1">// res0: cats.data.Validated[collection.immutable.ListMap[NonEmptyList[List[String]], NonEmptyList[ErrorMsg]], Address] = Invalid(
//   ListMap(
//     NonEmptyList(List(), List()) -&gt; NonEmptyList(ErrorMsg("bad-postcode", WrappedArray()), List())
//   )
// )
</span></code></pre></div></div>

<p>If we want to apply our validation rule to a step in a journey we
simply supply it as a parameter.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">askAddress2</span> <span class="k">=</span>
  <span class="n">ask</span><span class="o">[</span><span class="kt">Address</span><span class="o">](</span><span class="s">"post-to"</span><span class="o">,</span> <span class="n">validation</span> <span class="k">=</span> <span class="n">postcodeCheck</span><span class="o">)</span>
</code></pre></div></div>

<p>In this case we only have a single <code class="language-plaintext highlighter-rouge">Rule</code> applied to the <code class="language-plaintext highlighter-rouge">validation</code>
parameter.</p>

<p>If we wanted to check both a postcode against a Regex and that the 1st
line starts with a number we can either do this sequentially using
<code class="language-plaintext highlighter-rouge">followedBy</code> -</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="n">sequentialChecks</span><span class="k">:</span> <span class="kt">Rule</span><span class="o">[</span><span class="kt">Address</span><span class="o">]</span> <span class="k">=</span> 
  <span class="n">postcodeCheck</span> <span class="n">followedBy</span> 
    <span class="nc">Rule</span><span class="o">.</span><span class="n">cond</span><span class="o">[</span><span class="kt">Address</span><span class="o">](</span><span class="k">_</span><span class="o">.</span><span class="n">line1</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">isDigit</span><span class="o">,</span> <span class="s">"line-must-start-with-number"</span><span class="o">)</span>
</code></pre></div></div>
</section></div></div></div></div><script src="/uniform-scala/highlight/highlight.pack.js"></script><script src="/uniform-scala/lunr/lunr.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script src="/uniform-scala/js/search.js"></script><script src="/uniform-scala/js/docs.js"></script></body></html>