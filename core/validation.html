<html><head><title>uniform-scala: Validation</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Luke Tebbs" /><meta name="description" content="Purely functional user-interaction" /><meta name="og:image" content="/uniform-scala/img/poster.png" /><meta name="image" property="og:image" content="/uniform-scala/img/poster.png" /><meta name="og:title" content="uniform-scala: Validation" /><meta name="title" property="og:title" content="uniform-scala: Validation" /><meta name="og:site_name" content="uniform-scala" /><meta name="og:url" content="https://ltbs.github.io/uniform-scala/" /><meta name="og:type" content="website" /><meta name="og:description" content="Purely functional user-interaction" /><link rel="icon" type="image/png" href="/uniform-scala/img/favicon.png" /><meta name="twitter:title" content="uniform-scala: Validation" /><meta name="twitter:image" content="/uniform-scala/img/poster.png" /><meta name="twitter:description" content="Purely functional user-interaction" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/uniform-scala/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/uniform-scala/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/uniform-scala/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/uniform-scala/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/uniform-scala/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/uniform-scala/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/uniform-scala/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/uniform-scala/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/uniform-scala/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/uniform-scala/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/uniform-scala/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/uniform-scala/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/uniform-scala/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/uniform-scala/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/uniform-scala/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/uniform-scala/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/uniform-scala/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/uniform-scala/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/uniform-scala/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/uniform-scala/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/uniform-scala/highlight/styles/color-brewer.css" /><link rel="stylesheet" href="/uniform-scala/css/style.css" /><link rel="stylesheet" href="/uniform-scala/css/palette.css" /><link rel="stylesheet" href="/uniform-scala/css/codemirror.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/uniform-scala/" class="brand"><div class="brand-wrapper"><span>uniform-scala</span></div></a></li> <li><a href="/uniform-scala/index.html" class="">Home</a></li> <li><a href="/uniform-scala/setup.html" class="">Setup</a></li> <li><a href="/uniform-scala/core/basic-program.html" class="">Writing a journey</a> <ul class="sub_section"> <li><a href="/uniform-scala/core/tells.html" class="">Telling</a></li> <li><a href="/uniform-scala/core/asks.html" class="">Asking</a></li> <li><a href="/uniform-scala/core/interacts.html" class="">Interacting</a></li> <li><a href="/uniform-scala/core/validation.html" class=" active ">Validation</a></li> <li><a href="/uniform-scala/core/branching.html" class="">Branching</a></li> <li><a href="/uniform-scala/core/remote-calls.html" class="">Remote Calls</a></li></ul></li> <li><a href="/uniform-scala/play/index.html" class="">Play Framework Interpreter</a> <ul class="sub_section"> <li><a href="/uniform-scala/play/controllers.html" class="">Controllers</a></li> <li><a href="/uniform-scala/play/web-monad.html" class="">WebMonad</a></li> <li><a href="/uniform-scala/play/internationalisation.html" class="">Internationalisation</a></li> <li><a href="/uniform-scala/play/listing-pages.html" class="">Listing Pages</a></li> <li><a href="/uniform-scala/play/remote-calls.html" class="">Memoisation</a></li></ul></li> <li><a href="/uniform-scala/interpreters.html" class="">Other Interpreters</a> <ul class="sub_section"> <li><a href="/uniform-scala/interpreter-cli.html" class="">CLI Interpreter</a></li> <li><a href="/uniform-scala/interpreter-logic-table.html" class="">Logic Table Interpreter</a></li> <li><a href="/uniform-scala/interpreter-static-site.html" class="">Static Site interpreter</a></li> <li><a href="/uniform-scala/interpreter-selenium.html" class="">Selenium Interpreter</a></li></ul></li> <li><a href="/uniform-scala/core/advanced.html" class="">Advanced Options</a> <ul class="sub_section"> <li><a href="/uniform-scala/core/writing-interpreters.html" class="">Writing Interpreters</a></li></ul></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/ltbs/uniform-scala"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/ltbs/uniform-scala"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('uniform-scala Purely functional user-interaction');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('uniform-scala Purely functional user-interaction');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="ltbs" data-github-repo="uniform-scala"><div class="content-wrapper"><section><h1 id="validation">Validation</h1>

<p>For any given <code class="highlighter-rouge">interact[Tell, Ask]</code> the validation data structure is
<code class="highlighter-rouge">List[List[Rule[Ask]]]</code>.</p>

<p>Each inner groups of Rules is carried out ‘concurrently’ (error
accumulating) before sequentially passing validation on to the next
stage (fail-fast).</p>

<p>This means that error checking can be applied in-order, all together
or some mix of the two. For example, you might want to check that a
user supplies valid data on all the fields in an address. It would be
annoying for the user if they corrected an error on the first field
then resubmitted before seeing an error on the second field. In this
case you’d want the errors to accumulate. Once all the initial checks
pass you might want to then run a check afterwards, for example to
ensure the address actually exists or can be delivered to.</p>

<p>Lets start with an example with no validation at all -</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">ltbs.uniform._</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Address</span><span class="o">(</span>
    <span class="n">line1</span><span class="k">:</span> <span class="kt">NonEmptyString</span><span class="o">,</span>
    <span class="n">line2</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
    <span class="n">line3</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
    <span class="n">line4</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
    <span class="n">postcode</span><span class="k">:</span> <span class="kt">NonEmptyString</span>
<span class="o">)</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">lines</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
      <span class="nc">List</span><span class="o">(</span><span class="n">line1</span><span class="o">,</span> <span class="n">line2</span><span class="o">,</span> <span class="n">line3</span><span class="o">,</span> <span class="n">line4</span><span class="o">,</span> <span class="n">postcode</span><span class="o">)</span>
<span class="o">}</span>


<span class="k">type</span> <span class="kt">AskTypes</span> <span class="o">=</span> <span class="nc">Address</span> <span class="o">::</span> <span class="nc">NilTypes</span>
<span class="k">type</span> <span class="kt">TellTypes</span> <span class="o">=</span> <span class="nc">NilTypes</span>

<span class="k">def</span> <span class="n">askAddress1</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span>
  <span class="n">interpreter</span><span class="k">:</span> <span class="kt">Language</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">TellTypes</span>, <span class="kt">AskTypes</span><span class="o">]</span>
<span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">Address</span><span class="o">]</span> <span class="k">=</span>
  <span class="n">interpreter</span><span class="o">.</span><span class="n">ask</span><span class="o">[</span><span class="kt">Address</span><span class="o">](</span><span class="s">"post-to"</span><span class="o">)</span>
</code></pre></div></div>

<p>We can start with a single rule, a simple regex check against a postcode -</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats.data.NonEmptyList</span>

<span class="k">val</span> <span class="n">regex</span> <span class="k">=</span> <span class="s">"^[A-Z]{1,2}\\d[A-Z\\d]? ?\\d[A-Z]{2}$"</span>

<span class="k">val</span> <span class="n">postcodeCheck</span> <span class="k">=</span> <span class="nc">Rule</span><span class="o">.</span><span class="n">pattern</span><span class="o">[</span><span class="kt">Address</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">case</span> <span class="n">x</span> <span class="k">if</span> <span class="o">!</span><span class="n">x</span><span class="o">.</span><span class="n">postcode</span><span class="o">.</span><span class="n">matches</span><span class="o">(</span><span class="n">regex</span><span class="o">)</span> <span class="k">=&gt;</span>
    <span class="o">(</span><span class="nc">ErrorMsg</span><span class="o">(</span><span class="s">"bad-postcode"</span><span class="o">),</span> <span class="nc">NonEmptyList</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="s">"postcode"</span><span class="o">)))</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Here we have given a scenario for an error as a partial function. It
is important to remember we are dealing with negatives - matching
against a bad input rather than giving a predicate for a good
record.</p>

<p>The regex is used as a guard and an <code class="highlighter-rouge">ErrorMsg</code> is supplied
along with a non-empty path to where on the form/input data structure
the error applies. There can be several paths because in some cases
the error may be applicable to several fields - if the town doesn’t
match the postcode we might want to display the error on both those
fields.</p>

<p>We can now test our rule on the REPL or in a unit test -</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">testAddress</span><span class="k">:</span> <span class="kt">Address</span> <span class="o">=</span> <span class="nc">Address</span><span class="o">(</span>
     <span class="o">|</span>   <span class="nc">NonEmptyString</span><span class="o">(</span><span class="s">"12 The Street"</span><span class="o">),</span>
     <span class="o">|</span>   <span class="s">"Genericford"</span><span class="o">,</span>
     <span class="o">|</span>   <span class="s">"Madeupshire"</span><span class="o">,</span>
     <span class="o">|</span>   <span class="s">""</span><span class="o">,</span>
     <span class="o">|</span>   <span class="nc">NonEmptyString</span><span class="o">(</span><span class="s">"BAD POSTCODE"</span><span class="o">)</span>
     <span class="o">|</span> <span class="o">)</span>
<span class="n">testAddress</span><span class="k">:</span> <span class="kt">Address</span> <span class="o">=</span> <span class="nc">Address</span><span class="o">(</span><span class="mi">12</span> <span class="nc">The</span> <span class="nc">Street</span><span class="o">,</span><span class="nc">Genericford</span><span class="o">,</span><span class="nc">Madeupshire</span><span class="o">,,</span><span class="nc">BAD</span> <span class="nc">POSTCODE</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">postcodeCheck</span><span class="o">.</span><span class="n">apply</span><span class="o">(</span><span class="n">testAddress</span><span class="o">)</span>
<span class="n">res0</span><span class="k">:</span> <span class="kt">ltbs.uniform.ErrorTree</span> <span class="o">=</span> <span class="nc">ListMap</span><span class="o">(</span><span class="nc">NonEmptyList</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="n">postcode</span><span class="o">))</span> <span class="o">-&gt;</span> <span class="nc">NonEmptyList</span><span class="o">(</span><span class="nc">ErrorMsg</span><span class="o">(</span><span class="n">bad</span><span class="o">-</span><span class="n">postcode</span><span class="o">,</span><span class="nc">WrappedArray</span><span class="o">())))</span>
</code></pre></div></div>

<p>If we want to apply our validation rule to a step in a journey we
simply supply it as a parameter.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">askAddress2</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span>
  <span class="n">interpreter</span><span class="k">:</span> <span class="kt">Language</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">TellTypes</span>, <span class="kt">AskTypes</span><span class="o">]</span>
<span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">Address</span><span class="o">]</span> <span class="k">=</span>
  <span class="n">interpreter</span><span class="o">.</span><span class="n">ask</span><span class="o">[</span><span class="kt">Address</span><span class="o">](</span><span class="s">"post-to"</span><span class="o">,</span> <span class="n">validation</span> <span class="k">=</span> <span class="n">postcodeCheck</span><span class="o">)</span>
</code></pre></div></div>

<p>In this case we only have a single <code class="highlighter-rouge">Rule</code> applied to the <code class="highlighter-rouge">validation</code>
parameter, however Uniform will implicitly convert a solo <code class="highlighter-rouge">Rule</code> to a
<code class="highlighter-rouge">List[List[Rule]]</code> for us.</p>

<p>If we wanted to check both a postcode against a Regex and that the 1st
line starts with a number we might be tempted to do something like this -</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="n">dontDoThis</span> <span class="k">=</span> <span class="nc">Rule</span><span class="o">.</span><span class="n">pattern</span><span class="o">[</span><span class="kt">Address</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">case</span> <span class="n">x</span> <span class="k">if</span> <span class="o">!</span><span class="n">x</span><span class="o">.</span><span class="n">postcode</span><span class="o">.</span><span class="n">matches</span><span class="o">(</span><span class="n">regex</span><span class="o">)</span> <span class="k">=&gt;</span>
      <span class="o">(</span><span class="nc">ErrorMsg</span><span class="o">(</span><span class="s">"bad-postcode"</span><span class="o">),</span> <span class="nc">NonEmptyList</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="s">"postcode"</span><span class="o">)))</span>
    <span class="k">case</span> <span class="nc">Address</span><span class="o">(</span><span class="n">line1</span><span class="o">,</span> <span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">)</span> <span class="k">if</span> <span class="o">!</span><span class="n">line1</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">isDigit</span> <span class="k">=&gt;</span>
      <span class="o">(</span><span class="nc">ErrorMsg</span><span class="o">(</span><span class="s">"line1-too-long"</span><span class="o">),</span> <span class="nc">NonEmptyList</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="s">"line1"</span><span class="o">)))</span>
<span class="o">}</span>
</code></pre></div></div>

<p>However because we are passing in a single pattern match only the
first error case would apply.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">testAddress</span><span class="k">:</span> <span class="kt">Address</span> <span class="o">=</span> <span class="nc">Address</span><span class="o">(</span>
     <span class="o">|</span>   <span class="nc">NonEmptyString</span><span class="o">(</span><span class="s">"Fred"</span><span class="o">),</span>
     <span class="o">|</span>   <span class="s">"Genericford"</span><span class="o">,</span>
     <span class="o">|</span>   <span class="s">"Madeupshire"</span><span class="o">,</span>
     <span class="o">|</span>   <span class="s">""</span><span class="o">,</span>
     <span class="o">|</span>   <span class="nc">NonEmptyString</span><span class="o">(</span><span class="s">"BAD POSTCODE"</span><span class="o">)</span>
     <span class="o">|</span> <span class="o">)</span>
<span class="n">testAddress</span><span class="k">:</span> <span class="kt">Address</span> <span class="o">=</span> <span class="nc">Address</span><span class="o">(</span><span class="nc">Fred</span><span class="o">,</span><span class="nc">Genericford</span><span class="o">,</span><span class="nc">Madeupshire</span><span class="o">,,</span><span class="nc">BAD</span> <span class="nc">POSTCODE</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">dontDoThis</span><span class="o">.</span><span class="n">apply</span><span class="o">(</span><span class="n">testAddress</span><span class="o">)</span>
<span class="n">res1</span><span class="k">:</span> <span class="kt">ltbs.uniform.ErrorTree</span> <span class="o">=</span> <span class="nc">ListMap</span><span class="o">(</span><span class="nc">NonEmptyList</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="n">postcode</span><span class="o">))</span> <span class="o">-&gt;</span> <span class="nc">NonEmptyList</span><span class="o">(</span><span class="nc">ErrorMsg</span><span class="o">(</span><span class="n">bad</span><span class="o">-</span><span class="n">postcode</span><span class="o">,</span><span class="nc">WrappedArray</span><span class="o">())))</span>
</code></pre></div></div>

<p>If we wanted to assert them together we would need to create a group of
rules.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="n">postcodeCheck</span> <span class="k">=</span> <span class="nc">Rule</span><span class="o">.</span><span class="n">pattern</span><span class="o">[</span><span class="kt">Address</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">case</span> <span class="n">x</span> <span class="k">if</span> <span class="o">!</span><span class="n">x</span><span class="o">.</span><span class="n">postcode</span><span class="o">.</span><span class="n">matches</span><span class="o">(</span><span class="n">regex</span><span class="o">)</span> <span class="k">=&gt;</span>
    <span class="o">(</span><span class="nc">ErrorMsg</span><span class="o">(</span><span class="s">"bad-postcode"</span><span class="o">),</span> <span class="nc">NonEmptyList</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="s">"postcode"</span><span class="o">)))</span>
<span class="o">}</span>

<span class="k">val</span> <span class="n">line1Check</span> <span class="k">=</span> <span class="nc">Rule</span><span class="o">.</span><span class="n">pattern</span><span class="o">[</span><span class="kt">Address</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">Address</span><span class="o">(</span><span class="n">line1</span><span class="o">,</span> <span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">)</span> <span class="k">if</span> <span class="o">!</span><span class="n">line1</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">isDigit</span> <span class="k">=&gt;</span>
      <span class="o">(</span><span class="nc">ErrorMsg</span><span class="o">(</span><span class="s">"line1-too-long"</span><span class="o">),</span> <span class="nc">NonEmptyList</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="s">"line1"</span><span class="o">)))</span>
<span class="o">}</span>

<span class="k">val</span> <span class="n">errorAccumulating</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="n">postcodeCheck</span><span class="o">,</span> <span class="n">line1Check</span><span class="o">))</span>
<span class="k">val</span> <span class="n">failFast</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="n">postcodeCheck</span><span class="o">),</span> <span class="nc">List</span><span class="o">(</span><span class="n">line1Check</span><span class="o">))</span>
</code></pre></div></div>

<p>Should you want to test your rules you can turn a
<code class="highlighter-rouge">List[List[Rule[A]]]</code> into a <code class="highlighter-rouge">Rule[A]</code> with the <code class="highlighter-rouge">combined</code> method for
ready use on the REPL or inside of unit tests.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="n">errorAccumulating</span><span class="o">.</span><span class="n">combined</span><span class="o">(</span><span class="n">testAddress</span><span class="o">)</span>
<span class="n">res2</span><span class="k">:</span> <span class="kt">ltbs.uniform.ErrorTree</span> <span class="o">=</span> <span class="nc">ListMap</span><span class="o">(</span><span class="nc">NonEmptyList</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="n">postcode</span><span class="o">))</span> <span class="o">-&gt;</span> <span class="nc">NonEmptyList</span><span class="o">(</span><span class="nc">ErrorMsg</span><span class="o">(</span><span class="n">bad</span><span class="o">-</span><span class="n">postcode</span><span class="o">,</span><span class="nc">WrappedArray</span><span class="o">())),</span> <span class="nc">NonEmptyList</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="n">line1</span><span class="o">))</span> <span class="o">-&gt;</span> <span class="nc">NonEmptyList</span><span class="o">(</span><span class="nc">ErrorMsg</span><span class="o">(</span><span class="n">line1</span><span class="o">-</span><span class="n">too</span><span class="o">-</span><span class="n">long</span><span class="o">,</span><span class="nc">WrappedArray</span><span class="o">())))</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">failFast</span><span class="o">.</span><span class="n">combined</span><span class="o">(</span><span class="n">testAddress</span><span class="o">)</span>
<span class="n">res3</span><span class="k">:</span> <span class="kt">ltbs.uniform.ErrorTree</span> <span class="o">=</span> <span class="nc">ListMap</span><span class="o">(</span><span class="nc">NonEmptyList</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="n">postcode</span><span class="o">))</span> <span class="o">-&gt;</span> <span class="nc">NonEmptyList</span><span class="o">(</span><span class="nc">ErrorMsg</span><span class="o">(</span><span class="n">bad</span><span class="o">-</span><span class="n">postcode</span><span class="o">,</span><span class="nc">WrappedArray</span><span class="o">())))</span>
</code></pre></div></div>

<h2 id="special-rules">Special Rules</h2>

<p>You may be wondering why the rules are not functions like <code class="highlighter-rouge">A =&gt;
Either[ErrorTree, A]</code> which could automatically compose without the
need for the <code class="highlighter-rouge">combined</code> method above.</p>

<p>The reason for this is that we
have no way to decompose a function back again into its constituent
parts, and we may want to know what the parts are in order to offer
extra guidance to the user. For example, a textarea page in a web
representation may have a javascript hint for the number of characters
remaining.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="nc">Rule</span><span class="o">.</span><span class="n">max</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="mi">5</span><span class="o">).</span><span class="n">apply</span><span class="o">(</span><span class="s">"too long"</span><span class="o">)</span>
<span class="n">res4</span><span class="k">:</span> <span class="kt">ltbs.uniform.ErrorTree</span> <span class="o">=</span> <span class="nc">ListMap</span><span class="o">(</span><span class="nc">NonEmptyList</span><span class="o">(</span><span class="nc">List</span><span class="o">())</span> <span class="o">-&gt;</span> <span class="nc">NonEmptyList</span><span class="o">(</span><span class="nc">ErrorMsg</span><span class="o">(</span><span class="n">too</span><span class="o">-</span><span class="n">big</span><span class="o">,</span><span class="nc">WrappedArray</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">8</span><span class="o">))))</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nc">Rule</span><span class="o">.</span><span class="n">min</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Boolean</span><span class="o">]](</span><span class="n">min</span> <span class="k">=</span> <span class="mi">100</span><span class="o">).</span><span class="n">apply</span><span class="o">(</span><span class="nc">Nil</span><span class="o">)</span>
<span class="n">res5</span><span class="k">:</span> <span class="kt">ltbs.uniform.ErrorTree</span> <span class="o">=</span> <span class="nc">ListMap</span><span class="o">(</span><span class="nc">NonEmptyList</span><span class="o">(</span><span class="nc">List</span><span class="o">())</span> <span class="o">-&gt;</span> <span class="nc">NonEmptyList</span><span class="o">(</span><span class="nc">ErrorMsg</span><span class="o">(</span><span class="n">too</span><span class="o">-</span><span class="n">small</span><span class="o">,</span><span class="nc">WrappedArray</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="mi">0</span><span class="o">))))</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nc">Rule</span><span class="o">.</span><span class="n">size</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="n">min</span> <span class="k">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="k">=</span> <span class="mi">12</span><span class="o">).</span><span class="n">apply</span><span class="o">(</span><span class="s">"just right"</span><span class="o">)</span>
<span class="n">res6</span><span class="k">:</span> <span class="kt">ltbs.uniform.ErrorTree</span> <span class="o">=</span> <span class="nc">ListMap</span><span class="o">()</span>
</code></pre></div></div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/uniform-scala/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlighting();
              </script><script src="/uniform-scala/js/main.js"></script></body></html>